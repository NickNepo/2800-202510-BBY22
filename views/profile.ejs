<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/header') %>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      <%= user.username %> â€” Profile
    </title>
</head>

<body class="bg-[#BCDA94] min-h-screen flex flex-col">
  <!-- Top Navbar -->
  <%- include('partials/topNavbar') %>

    <!-- Curved header -->
    <header class="h-32 bg-[#BCDA94] rounded-b-3xl"></header>

    <!-- Avatar overlapping -->
    <div class="relative -mt-16 flex justify-center">
      <div class="w-28 h-28 bg-[#F7F1E6] rounded-full p-1 border border-black">
        <img src="<%= user.avatarUrl?.trim() ? user.avatarUrl : '/blank-pfp.webp' %>"
          alt="<%= user.username %>'s avatar" class="w-full h-full rounded-full object-cover" />
      </div>
    </div>

    <!-- Main content -->
    <main class="flex-1 bg-[#F7F1E6] -mt-8 p-6 flex flex-col rounded-t-3xl">
      <!-- Username -->
      <h1 class="text-3xl font-bold text-[#102128] text-center">
        <%= user.username %>
      </h1>

      <!-- Streak counter + Edit button -->
      <div class="mt-6 flex justify-center items-center space-x-4">
        <!-- Streak pill -->
        <div class="flex items-center bg-[#ECB779] border border-gray-400 rounded-full px-4 py-2 space-x-2 shadow-sm">
          <span class="text-2xl">ðŸ”¥</span>
          <span class="text-xl font-semibold">
            <%= user.streakCount %>
          </span>
        </div>
        <!-- Edit Profile pill -->
        <a href="/profile/edit"
          class="flex items-center bg-white text-[#102128] border border-gray-400 rounded-full px-4 py-2 shadow-sm hover:bg-gray-100 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15.232 5.232l3.536 3.536M9 11l6 6L21 11l-6-6-6 6zm0 0L3 11l6 6 6-6z" />
          </svg>
          Edit Profile
        </a>
      </div>

      <!-- Thin centered divider -->
      <hr class="w-24 border-t-2 border-gray-300 my-6 mx-auto" />

      <!-- Divider -->
      <hr class="border-t border-gray-300 my-4" />

      <!-- Divider -->
      <hr class="border-t border-gray-300 my-4" />

      <!-- Bio -->
      <p class="text-center text-[#102128] text-lg">
        <%= user.bio || 'Bio goes here' %>
      </p>

      <!-- Summary line -->
      <p class="mt-2 text-center text-[#102128]">
        <%= user.username %> completed <%= user.CompletedTasksCount %> tasks!
      </p>

      <!-- Toggle list button -->
      <div class="mt-6 flex justify-center">
        <button id="toggleTasks" class="px-6 py-3 bg-[#ECB779] text-white rounded-lg hover:bg-[#D9A660] transition">
          Show Completed Tasks
        </button>
      </div>

      <!-- Completed tasks list -->
      <div id="tasksList" class="hidden mt-4 space-y-4">
        <% if (completedTasks.length) { %>
          <% completedTasks.forEach(ch=> { %>
            <button class="w-full bg-[#ECB779] text-[#102128] px-6 py-4 rounded-lg text-left shadow">
              <%= ch.name %>
            </button>
            <% }) %>
              <% } else { %>
                <p class="text-center text-gray-500">No tasks completed yet.</p>
                <% } %>
      </div>
    </main>

    <!-- Bottom Navbar -->
    <%- include('partials/bottomNavbar') %>

      <script>
        document.getElementById("toggleTasks").addEventListener("click", function () {
          const list = document.getElementById("tasksList");
          if (list.classList.contains("hidden")) {
            list.classList.remove("hidden");
            this.textContent = "Hide Completed Tasks";
          } else {
            list.classList.add("hidden");
            this.textContent = "Show Completed Tasks";
          }
        });
      </script>
</body>

</html>