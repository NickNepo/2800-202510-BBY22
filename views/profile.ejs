<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include('partials/header') %>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title><%= user.username %> â€” Profile</title>
    </head>
    <body class="bg-[#BCDA94] min-h-screen flex flex-col">
        <!-- Top Navbar -->
        <%- include('partials/topNavbar') %>

        <!-- Header curved bottom -->
        <header class="h-32 bg-[#BCDA94] rounded-b-3xl"></header>

        <!-- Avatar overlapping -->
        <div class="relative -mt-16 flex justify-center">
            <div class="w-28 h-28 bg-[#F7F1E6] rounded-full p-1 border border-black">
                <img
                    src="<%= user.avatarUrl && user.avatarUrl.trim().length ? user.avatarUrl : '/blank-pfp.webp' %>"
                    alt="<%= user.username %>'s avatar"
                    class="w-full h-full rounded-full object-cover"
                />
            </div>
        </div>

        <!-- Main content card -->
        <main class="flex-1 bg-[#F7F1E6] -mt-8 p-6 flex flex-col rounded-t-3xl">
            <!-- Username -->
            <h1 class="text-3xl font-bold text-[#102128] text-center"><%= user.username %></h1>

            <!-- Completed tasks and Edit button -->
            <div class="mt-4 flex justify-center items-center space-x-4">
                <div class="flex items-center bg-[#ECB779] border-black rounded-lg px-3 py-1 space-x-2">
                    <span class="text-2xl">ðŸ”¥</span>
                    <span class="text-2xl font-semibold"><%= user.streakCount %></span>
                </div>
                <a href="/profile/edit" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition"> Edit Profile </a>
            </div>

            <!-- Divider -->
            <hr class="border-t border-gray-300 my-4" />

            <!-- Bio -->
            <p class="text-center text-[#102128] text-lg"><%= user.bio || 'Bio goes here' %></p>

            <!-- Summary line -->
            <p class="mt-2 text-center text-[#102128]"><%= user.username %> completed <%= user.CompletedTasksCount %> tasks!</p>

            <!-- Toggle list button -->
            <div class="mt-6 flex justify-center">
                <button id="toggleTasks" class="px-6 py-3 bg-[#ECB779] text-white rounded-lg hover:bg-[#D9A660] transition">
                    Show Completed Tasks
                </button>
            </div>

            <!-- Completed tasks list (hidden by default) -->
            <div id="tasksList" class="hidden mt-4 space-y-4">
                <% (user.completedTasks || []).forEach(task => { %>
                <button class="w-full bg-[#ECB779] text-[#102128] px-6 py-4 rounded-lg text-left shadow"><%= task %></button>
                <% }) %>
            </div>
        </main>

        <!-- Bottom Navbar -->
        <%- include('partials/bottomNavbar') %>

        <script>
            document.getElementById("toggleTasks").addEventListener("click", function () {
                var list = document.getElementById("tasksList");
                if (list.classList.contains("hidden")) {
                    list.classList.remove("hidden");
                    this.textContent = "Hide Completed Tasks";
                } else {
                    list.classList.add("hidden");
                    this.textContent = "Show Completed Tasks";
                }
            });
        </script>
    </body>
</html>
